
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Creating new comparisons and comparison levels - Splink</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-new-comparisons-and-comparison-levels-for-libraries" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Creating new comparisons and comparison levels
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../../img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Topic Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Topic Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Topic Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/backends.html" class="md-nav__link">
        Splink's SQL backends - Spark, DuckDB etc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/querying_splink_results.html" class="md-nav__link">
        Retrieving and querying Splink results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/link_type.html" class="md-nav__link">
        Link type - linking vs deduping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/customising_comparisons.html" class="md-nav__link">
        Defining and customising comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/comparators.html" class="md-nav__link">
        Comparators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/phonetic.html" class="md-nav__link">
        Phonetic transformations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/blocking_rules.html" class="md-nav__link">
        Blocking rules for prediction vs estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/drivers_of_performance.html" class="md-nav__link">
        Run times, performance and linking large data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/optimising_spark.html" class="md-nav__link">
        Optimising Spark performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topic_guides/salting.html" class="md-nav__link">
        Salting blocking rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Linker API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linker API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Linker API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linker.html" class="md-nav__link">
        Full API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkerexp.html" class="md-nav__link">
        Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkerest.html" class="md-nav__link">
        Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkerpred.html" class="md-nav__link">
        Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkerqa.html" class="md-nav__link">
        Visualisation and quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../em_training_session.html" class="md-nav__link">
        EM Training Session API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SplinkDataFrame.html" class="md-nav__link">
        SplinkDataFrame API
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Comparisons API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Comparisons API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison.html" class="md-nav__link">
        Comparison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_level.html" class="md-nav__link">
        Comparison Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Comparisons Library API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons Library API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons Library API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_library.html" class="md-nav__link">
        Comparison Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_template_library.html" class="md-nav__link">
        Comparison Template Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_level_library.html" class="md-nav__link">
        Comparison Level Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../comparison_level_composition.html" class="md-nav__link">
        Comparison Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../settingseditor/editor.html" class="md-nav__link">
        Settings Editor
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../settings_dict_guide.html" class="md-nav__link">
        Settings dictionary reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/00_Tutorial_Introduction.html" class="md-nav__link">
        0. Tutorial introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/01_Prerequisites.html" class="md-nav__link">
        1. Data prep prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/02_Exploratory_analysis.html" class="md-nav__link">
        2. Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/03_Blocking.html" class="md-nav__link">
        3. Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/04_Estimating_model_parameters.html" class="md-nav__link">
        4. Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/05_Predicting_results.html" class="md-nav__link">
        5. Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/06_Visualising_predictions.html" class="md-nav__link">
        6. Visualising predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/07_Quality_assurance.html" class="md-nav__link">
        7. Quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples_index.html" class="md-nav__link">
        Examples index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          DuckDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DuckDB" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          DuckDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_deduplicate_50k_synthetic.html" class="md-nav__link">
        Deduplicate 50k rows historical persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_transactions.html" class="md-nav__link">
        Linking financial transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_link_only.html" class="md-nav__link">
        Linking two tables of persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_real_time_record_linkage.html" class="md-nav__link">
        Real time record linkage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_accuracy_analysis_from_labels_column.html" class="md-nav__link">
        QA from ground truth column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_pairwise_labels.html" class="md-nav__link">
        Estimating m probabilities from labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_quick_and_dirty_persons.html" class="md-nav__link">
        Quick and dirty persons model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_febrl3.html" class="md-nav__link">
        Febrl3 Dedupe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_febrl4.html" class="md-nav__link">
        Febrl4 link-only
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          PySpark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PySpark" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          PySpark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/example_simple_pyspark.html" class="md-nav__link">
        Deduplication using Pyspark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Developers' guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers' guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Developers' guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1">
          Making Changes to Splink
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Making Changes to Splink" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          Making Changes to Splink
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changing_splink/building_env_locally.html" class="md-nav__link">
        Building a Virtual Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changing_splink/lint.html" class="md-nav__link">
        Linting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changing_splink/build_docs_locally.html" class="md-nav__link">
        Building Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changing_splink/running_tests_locally.html" class="md-nav__link">
        Running Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../caching.html" class="md-nav__link">
        Caching and pipelining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug_modes.html" class="md-nav__link">
        Understanding and debugging Splink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark_pipelining_and_caching.html" class="md-nav__link">
        Spark caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../transpilation.html" class="md-nav__link">
        Transpilation using sqlglot
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_6" type="checkbox" id="__nav_8_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8_6">
          Comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons and comparison levels" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_6">
          <span class="md-nav__icon md-icon"></span>
          Comparisons and comparison levels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Creating new comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="new_library_comparisons_and_levels.html" class="md-nav__link md-nav__link--active">
        Creating new comparisons and comparison levels
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-new-comparison-levels" class="md-nav__link">
    Creating new comparison levels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-new-comparisons" class="md-nav__link">
    Creating new comparisons
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="extending_library_comparisons_and_levels.html" class="md-nav__link">
        Extending existing comparisons and comparison levels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-new-comparison-levels" class="md-nav__link">
    Creating new comparison levels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-new-comparisons" class="md-nav__link">
    Creating new comparisons
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  

  <nav class="md-tags" >
    
      
      
        <span class="md-tag">API</span>
      
    
      
      
        <span class="md-tag">comparisons</span>
      
    
  </nav>



  <a href="https://github.com/moj-analytical-services/splink/edit/master/docs/dev_guides/comparisons/new_library_comparisons_and_levels.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="creating-new-comparisons-and-comparison-levels-for-libraries">Creating new comparisons and comparison levels for libraries<a class="headerlink" href="#creating-new-comparisons-and-comparison-levels-for-libraries" title="Permanent link">&para;</a></h1>
<p>The Fellegi-Sunter model that Splink implements depends on having several comparisons, which are each composed of two or more comparison levels.
Splink provides several <em>ready-made</em> <a href="../../comparison_library.html">comparisons</a> and <a href="../../comparison_level_library.html">comparison levels</a> to use out-of-the-box, but you may find in your particular application that you have to <a href="../../topic_guides/customising_comparisons.html#method-4-providing-the-spec-as-a-dictionary">create your own custom versions</a> if there is not a suitable comparison/level for the <a href="../../topic_guides/backends.html">SQL dialect you are working with</a> (or for any available dialects).</p>
<p>Having created a custom comparison you may decide that your use case is common enough that you want to contribute it to Splink for other users to benefit from. This guide will take you through the process of doing so. Looking at existing examples should also prove to be useful for further guidance, and to perhaps serve as a starting template.</p>
<p>After creating your new levels/comparisons, be sure to add some tests to help ensure that the code runs without error and behaves as expected.</p>
<p>This guide is for adding new comparisons and comparison levels from scratch. If you instead want to create specialised versions of existing levels, be sure to also have a look at the <a href="./extending_library_comparisons_and_levels.html">guide for extending existing library entries</a>.</p>
<h2 id="creating-new-comparison-levels">Creating new comparison levels<a class="headerlink" href="#creating-new-comparison-levels" title="Permanent link">&para;</a></h2>
<p>For this example, let's consider a comparison level that compares if the length of two arrays are within <code>n</code> of one another (without reference to the contents of these arrays) for some non-negative integer <code>n</code>. An example of this might be if we were linking people with partial address information in two tables --- in one table we have an array of postcodes, and the other table we have an array of road-names. We don't expect them to match, but we are probably interested if the count of the number of objects within each array are similar - each corresponding to the number of addresses per person.</p>
<p>To create a new comparison level, you must create a new subclass of <code>ComparisonLevel</code> which will serve as the base comparison level for any SQL dialects that will allow this level, in the file <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/comparison_level_library.py"><code>splink/comparison_level_library.py</code></a>.
It will contain the full logic for creating the comparison level - any dialect dependencies will be implemented as properties on the specific dialect-dependent object.
In this case we will need to refer to a property <code>_array_length_function_name</code>, as this can vary by dialect.
We will not define the property directly on this object, as our dialect-dependent versions will inherit this property from elsewhere.
We also include any customisable parameters for our level - in this case we will allow options for the maximum number of elements the array may differ by.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ArrayLengthLevelBase</span><span class="p">(</span><span class="n">ComparisonLevel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length_difference</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">m_probability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compares two arrays whose sizes are within a fixed distance</span>
<span class="sd">        | length(arr_1) - length(arr_2) | &lt;= (length_difference)</span>

<span class="sd">        Arguments:</span>
<span class="sd">            col_name (str): Input column name</span>
<span class="sd">            length_difference (int): Maximum difference in array lengths</span>
<span class="sd">            m_probability (float, optional): Starting value for m probability.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ComparisonLevel: A comparison level that evaluates the size difference</span>
<span class="sd">                between two arrays</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">InputColumn</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">sql_dialect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span><span class="p">)</span>
        <span class="n">col_l</span><span class="p">,</span> <span class="n">col_r</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">names_l_r</span><span class="p">()</span>

        <span class="n">sql_exp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;abs(&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_length_function_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">col_l</span><span class="si">}</span><span class="s2">) - &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_length_function_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">col_r</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;) &lt;= </span><span class="si">{</span><span class="n">length_difference</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">level_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sql_condition&quot;</span><span class="p">:</span> <span class="n">sql_exp</span><span class="p">,</span>
            <span class="s2">&quot;label_for_charts&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Array sizes differ by at most </span><span class="si">{</span><span class="n">length_difference</span><span class="p">)</span><span class="s2">&quot;,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">m_probability</span><span class="p">:</span>
            <span class="n">level_dict</span><span class="p">[</span><span class="s2">&quot;m_probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_probability</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level_dict</span><span class="p">,</span> <span class="n">sql_dialect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span><span class="p">)</span>
</code></pre></div>
<p>If you are using a new dialect-dependent property (as we are in this case), then it should be added as a property on <code>DialectBase</code> in <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/dialect_base.py"><code>splink.dialect_base.py</code></a>,
with either a sensible default value, or raising a <code>NotImplementedError</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">DialectBase</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_array_length_function_name</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;`array_length_function_name` not implemented on base class&quot;</span>
        <span class="p">)</span>
</code></pre></div>
<p>Then any dialects that use a different value can override this (e.g in <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/spark/spark_base.py"><code>splink.spark.spark_base.py</code></a>):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SparkBase</span><span class="p">(</span><span class="n">DialectBase</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_array_length_function_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;array_size&quot;</span>
</code></pre></div>
<p>Then any dialects where this comparison level can be used can simply inherit from this dialect-specific base, along with the comparison level base <code>ArrayLengthLevelBase</code> - here in <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/spark/spark_comparison_level_library.py"><code>splink.spark.spark_comparison_level_library.py</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">array_length_level</span><span class="p">(</span><span class="n">SparkBase</span><span class="p">,</span> <span class="n">ArrayLengthLevelBase</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<p>Similarly for DuckDB define the appropriate function name in the base <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/duckdb/duckdb_base.py"><code>splink.duckdb.duckdb_base.py</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">DuckDBBase</span><span class="p">(</span><span class="n">DialectBase</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_array_length_function_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;array_length&quot;</span>
</code></pre></div>
<p>and then simply create the level in the corresponding library <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/duckdb/duckdb_comparison_level_library.py"><code>splink.duckdb.duckdb_comparison_level_library.py</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">array_length_level</span><span class="p">(</span><span class="n">DuckDBBase</span><span class="p">,</span> <span class="n">ArrayLengthLevelBase</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<p>The names of these should be the same for all dialects (and written in snake-case), with them being distinguished solely by path.</p>
<h2 id="creating-new-comparisons">Creating new comparisons<a class="headerlink" href="#creating-new-comparisons" title="Permanent link">&para;</a></h2>
<p>The process for creating new library <code>Comparison</code>s is similar to the <code>ComparisonLevel</code> case, but slightly more involved.
This is due to the fact that dialect-specific <code>Comparison</code>s need to 'know' about
the dialect-specific <code>ComparisonLevel</code>s that they employ.</p>
<p>As an example, we will consider a new <code>Comparison</code> that makes use of our new <code>array_length_level</code> above.
Specifically, it will have the following levels:</p>
<ul>
<li>an optional <code>exact_match_level</code></li>
<li>one or more <code>array_length_level</code>s with different values of <code>length_difference</code>, as specified</li>
<li>an <code>else_level</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ArrayLengthAtThresholdsComparisonBase</span><span class="p">(</span><span class="n">Comparison</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length_thresholds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">include_exact_match_level</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">m_probability_exact_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">m_probability_or_probabilities_sizes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">m_probability_else</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A comparison of the data in the array column `col_name` with various</span>
<span class="sd">        size difference thresholds to assess similarity levels.</span>

<span class="sd">        An example of the output with default arguments and settings</span>
<span class="sd">        `length_thresholds = [0]` would be</span>
<span class="sd">        - An exact match</span>
<span class="sd">        - The two arrays are the same length</span>
<span class="sd">        - Anything else (i.e. the arrays are difference lengths)</span>

<span class="sd">        Args:</span>
<span class="sd">            col_name (str): The name of the array column to compare.</span>
<span class="sd">            length_thresholds (Union[int, list], optional): The difference(s) between</span>
<span class="sd">                array sizes of thresholds, to assess whether two arrays are within a</span>
<span class="sd">                given length difference.</span>
<span class="sd">            include_exact_match_level (bool, optional): If True, include an exact match</span>
<span class="sd">                level. Defaults to True.</span>
<span class="sd">            term_frequency_adjustments (bool, optional): If True, apply term frequency</span>
<span class="sd">                adjustments to the exact match level. Defaults to False.</span>
<span class="sd">            m_probability_exact_match (float, optional): If provided, overrides the</span>
<span class="sd">                default m probability for the exact match level. Defaults to None.</span>
<span class="sd">            m_probability_or_probabilities_sizes (Union[float, list], optional):</span>
<span class="sd">                _description_. If provided, overrides the default m probabilities</span>
<span class="sd">                for the sizes specified. Defaults to None.</span>
<span class="sd">            m_probability_else (float, optional): If provided, overrides the</span>
<span class="sd">                default m probability for the &#39;anything else&#39; level. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Comparison: A comparison that can be inclued in the Splink settings</span>
<span class="sd">                dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">thresholds</span> <span class="o">=</span> <span class="n">ensure_is_iterable</span><span class="p">(</span><span class="n">length_thresholds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">m_probability_or_probabilities_sizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_probability_or_probabilities_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span>
        <span class="n">m_probabilities</span> <span class="o">=</span> <span class="n">ensure_is_iterable</span><span class="p">(</span><span class="n">m_probability_or_probabilities_sizes</span><span class="p">)</span>

        <span class="n">comparison_levels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comparison_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_null_level</span><span class="p">(</span><span class="n">col_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">include_exact_match_level</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exact_match_level</span><span class="p">(</span>
                <span class="n">col_name</span><span class="p">,</span>
                <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="n">term_frequency_adjustments</span><span class="p">,</span>
                <span class="n">m_probability</span><span class="o">=</span><span class="n">m_probability_exact_match</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">comparison_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">length_thres</span><span class="p">,</span> <span class="n">m_prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">m_probabilities</span><span class="p">):</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array_length_level</span><span class="p">(</span>
                <span class="n">col_name</span><span class="p">,</span>
                <span class="n">length_difference</span><span class="o">=</span><span class="n">length_thres</span><span class="p">,</span>
                <span class="n">m_probability</span><span class="o">=</span><span class="n">m_prob</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">comparison_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

        <span class="n">comparison_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_else_level</span><span class="p">(</span><span class="n">m_probability</span><span class="o">=</span><span class="n">m_probability_else</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">comparison_desc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include_exact_match_level</span><span class="p">:</span>
            <span class="n">comparison_desc</span> <span class="o">+=</span> <span class="s2">&quot;Exact match vs. &quot;</span>

        <span class="n">thres_desc</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span>
        <span class="n">plural</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;s&quot;</span>
        <span class="n">comparison_desc</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Array length differences with threshold</span><span class="si">{</span><span class="n">plural</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">thres_desc</span><span class="si">}</span><span class="s2"> vs. &quot;</span>
        <span class="p">)</span>
        <span class="n">comparison_desc</span> <span class="o">+=</span> <span class="s2">&quot;anything else&quot;</span>

        <span class="n">comparison_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;comparison_description&quot;</span><span class="p">:</span> <span class="n">comparison_desc</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="n">comparison_levels</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">comparison_dict</span><span class="p">)</span>
</code></pre></div>
<p>Crucially we needed to use <code>self._null_level</code>, <code>self._exact_match_level</code>, <code>self._else_level</code> which already exist,
but also the new <code>self._array_length_level</code> which relates to our new comparison level.
We will need to make sure that the dialect-specific comparisons which will actually be <em>used</em> will have this property.</p>
<p>Each dialect has a comparison properties base, which stores information about all of the dialect-specific comparison levels used by all comparisons.
We will need to add our new level to this, which we referred to above in <code>ArrayLengthAtThresholdsComparisonBase</code> - for this example in <a href="https://github.com/moj-analytical-services/splink/blob/master/splink/spark/spark_comparison_library.py"><code>splink.spark.spark_comparison_library.py</code></a>:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.spark.spark_comparison_level_library</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">exact_match_level</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="n">array_length_level</span><span class="p">,</span>
<span class="p">)</span>
<span class="o">...</span>

<span class="k">class</span> <span class="nc">SparkComparisonProperties</span><span class="p">(</span><span class="n">SparkBase</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_exact_match_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">exact_match_level</span>
    <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_array_length_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">array_length_level</span>
</code></pre></div></p>
<p>Any dialect-specific version of comparisons will inherit from this (where it learns about the dialect-specific comparison levels), and the comparison itself; in our case, in the same file:</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="k">class</span> <span class="nc">array_length_at_thresholds</span><span class="p">(</span>
    <span class="n">SparkComparisonProperties</span><span class="p">,</span> <span class="n">ArrayLengthAtThresholds</span>
<span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
<p>This is now ready to import and be used, just as any other pre-existing comparisons.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../transpilation.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Transpilation using sqlglot" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Transpilation using sqlglot
            </div>
          </div>
        </a>
      
      
        
        <a href="extending_library_comparisons_and_levels.html" class="md-footer__link md-footer__link--next" aria-label="Next: Extending existing comparisons and comparison levels" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Extending existing comparisons and comparison levels
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    
  </body>
</html>